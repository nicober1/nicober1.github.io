"use strict";(self.webpackChunkfluentblogs=self.webpackChunkfluentblogs||[]).push([[2409],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>y});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var g=o.createContext({}),d=function(e){var n=o.useContext(g),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},l=function(e){var n=d(e.components);return o.createElement(g.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,g=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),c=d(t),p=r,y=c["".concat(g,".").concat(p)]||c[p]||u[p]||a;return t?o.createElement(y,s(s({ref:n},l),{},{components:t})):o.createElement(y,s({ref:n},l))}));function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,s=new Array(a);s[0]=p;var i={};for(var g in n)hasOwnProperty.call(n,g)&&(i[g]=n[g]);i.originalType=e,i[c]="string"==typeof e?e:r,s[1]=i;for(var d=2;d<a;d++)s[d]=t[d];return o.createElement.apply(null,s)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},6168:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>g,default:()=>y,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var o=t(87462),r=t(63366),a=(t(67294),t(3905)),s=["components"],i={keywords:["ASP.NET Core Web API Middleware"]},g=void 0,d={unversionedId:"ASP.NET Core Web API Middleware",id:"ASP.NET Core Web API Middleware",title:"ASP.NET Core Web API Middleware",description:"",source:"@site/docs/ASP.NET Core Web API Middleware.md",sourceDirName:".",slug:"/ASP.NET Core Web API Middleware",permalink:"/docs/ASP.NET Core Web API Middleware",draft:!1,tags:[],version:"current",frontMatter:{keywords:["ASP.NET Core Web API Middleware"]},sidebar:"myAutogeneratedSidebar",previous:{title:"ASP.NET Core Web API HangFire",permalink:"/docs/ASP.NET Core Web API HangFire"},next:{title:"ASP.NET Core Web API Notes",permalink:"/docs/ASP.NET Core Web API Notes"}},l={},c=[],u={toc:c},p="wrapper";function y(e){var n=e.components,t=(0,r.Z)(e,s);return(0,a.kt)(p,(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'\npublic class LoggingMiddleware\n{\n    private readonly RequestDelegate _next;\n    private readonly ILogger<LoggingMiddleware> _logger;\n\n    public LoggingMiddleware(RequestDelegate next, ILogger<LoggingMiddleware> logger)\n    {\n        _next = next;\n        _logger = logger;\n    }\n\n    public async Task Invoke(HttpContext context)\n    {\n        // Check if the request should be logged based on a flag\n        bool shouldLog = !context.Request.Headers.ContainsKey("X-Bypass-Logging");\n\n        // Log the request\n        if (shouldLog)\n        {\n            _logger.LogInformation($"Request: {context.Request.Method} {context.Request.Path}");\n            _logger.LogInformation($"Request Headers: {context.Request.Headers}");\n            _logger.LogInformation($"Request Body: {await GetRequestBody(context.Request)}");\n        }\n\n        // Call the next middleware in the pipeline\n        await _next(context);\n\n        // Log the response\n        if (shouldLog)\n        {\n            _logger.LogInformation($"Response: {context.Response.StatusCode}");\n            _logger.LogInformation($"Response Headers: {context.Response.Headers}");\n            _logger.LogInformation($"Response Body: {await GetResponseBody(context.Response)}");\n        }\n    }\n\n    private async Task<string> GetRequestBody(HttpRequest request)\n    {\n        request.EnableBuffering();\n        using var reader = new StreamReader(request.Body, Encoding.UTF8, true, 1024, true);\n        var body = await reader.ReadToEndAsync();\n        request.Body.Position = 0;\n        return body;\n    }\n\n    private async Task<string> GetResponseBody(HttpResponse response)\n    {\n        response.Body.Seek(0, SeekOrigin.Begin);\n        var body = await new StreamReader(response.Body).ReadToEndAsync();\n        response.Body.Seek(0, SeekOrigin.Begin);\n        return body;\n    }\n}\n\n//\n\n  app.UseMiddleware<LoggingMiddleware>();\n\n\n  //\n\n\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.Extensions.Logging;\nusing System;\nusing System.IO;\nusing System.Threading.Tasks;\n\npublic class LoggingMiddleware\n{\n    private readonly RequestDelegate _next;\n    private readonly ILogger<LoggingMiddleware> _logger;\n\n    public LoggingMiddleware(RequestDelegate next, ILogger<LoggingMiddleware> logger)\n    {\n        _next = next;\n        _logger = logger;\n    }\n\n    public async Task InvokeAsync(HttpContext context)\n    {\n        if (context.Request.Query.ContainsKey("skipLogging"))\n        {\n            await _next(context);\n            return;\n        }\n\n        // Log request\n        _logger.LogInformation($"Request {context.Request.Method} {context.Request.Path}");\n        if (context.Request.Headers != null && context.Request.Headers.Count > 0)\n        {\n            _logger.LogInformation($"Headers: {string.Join(",", context.Request.Headers)}");\n        }\n        if (context.Request.ContentLength.HasValue && context.Request.ContentLength > 0)\n        {\n            context.Request.EnableBuffering();\n            var body = await new StreamReader(context.Request.Body).ReadToEndAsync();\n            _logger.LogInformation($"Body: {body}");\n            context.Request.Body.Position = 0;\n        }\n\n        // Call the next middleware\n        await _next(context);\n\n        // Log response\n        _logger.LogInformation($"Response {context.Response.StatusCode}");\n        if (context.Response.Headers != null && context.Response.Headers.Count > 0)\n        {\n            _logger.LogInformation($"Headers: {string.Join(",", context.Response.Headers)}");\n        }\n        if (context.Response.ContentLength.HasValue && context.Response.ContentLength > 0)\n        {\n            context.Response.Body.Seek(0, SeekOrigin.Begin);\n            var body = await new StreamReader(context.Response.Body).ReadToEndAsync();\n            _logger.LogInformation($"Body: {body}");\n            context.Response.Body.Seek(0, SeekOrigin.Begin);\n        }\n    }\n}\n\n\n')))}y.isMDXComponent=!0}}]);