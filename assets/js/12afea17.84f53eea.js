"use strict";(self.webpackChunkfluentblogs=self.webpackChunkfluentblogs||[]).push([[5331],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>y});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),l=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=l(e.components);return a.createElement(p.Provider,{value:n},e.children)},g="mdxType",w={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),g=l(t),h=r,y=g["".concat(p,".").concat(h)]||g[h]||w[h]||o;return t?a.createElement(y,s(s({ref:n},c),{},{components:t})):a.createElement(y,s({ref:n},c))}));function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,s=new Array(o);s[0]=h;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i[g]="string"==typeof e?e:r,s[1]=i;for(var l=2;l<o;l++)s[l]=t[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},15899:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>p,default:()=>y,frontMatter:()=>i,metadata:()=>l,toc:()=>g});var a=t(87462),r=t(63366),o=(t(67294),t(3905)),s=["components"],i={keywords:["Playwright"]},p=void 0,l={unversionedId:"Playwright",id:"Playwright",title:"Playwright",description:"",source:"@site/docs/Playwright.md",sourceDirName:".",slug:"/Playwright",permalink:"/docs/Playwright",draft:!1,tags:[],version:"current",frontMatter:{keywords:["Playwright"]},sidebar:"myAutogeneratedSidebar",previous:{title:"Investment Banking Notes",permalink:"/docs/Investment Banking Notes"},next:{title:"Python",permalink:"/docs/Python"}},c={},g=[],w={toc:g},h="wrapper";function y(e){var n=e.components,t=(0,r.Z)(e,s);return(0,o.kt)(h,(0,a.Z)({},w,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# Save storage state into the file.\nstorage = context.storage_state(path="state.json")\n\n# Create a new context with the saved storage state.\ncontext = browser.new_context(storage_state="state.json")\n\n$Env:PLAYWRIGHT_BROWSERS_PATH="$Env:USERPROFILE\\pw-browsers"\npip install playwright\nplaywright install\n\n\n$Env:PLAYWRIGHT_BROWSERS_PATH="$Env:USERPROFILE\\pw-browsers"\npython playwright_script.py\n\nPLAYWRIGHT_SKIP_BROWSER_GC=1\n\npage.wait_for_timeout(5000)\n\nfrom playwright.sync_api import expect\n\nexpect.set_options(timeout=10_000)\nexpect(page.get_by_text("Name")).to_be_visible(timeout=10_000)\n\nplaywright codegen demo.playwright.dev/todomvc\n\n\nfrom playwright.sync_api import Playwright, sync_playwright, expect\n\n\ndef run(playwright: Playwright) -> None:\n    browser = playwright.chromium.launch(headless=False)\n    context = browser.new_context()\n    page = context.new_page()\n    page.goto("about:blank")\n    page.goto("chrome-error://chromewebdata/")\n    page.locator("div").filter(has_text="Your connection is not private Attackers might be trying to steal your informati").first.click()\n    page.get_by_role("button", name="Advanced").click()\n    page.get_by_role("link", name="Proceed to ").click()\n    page.get_by_placeholder("user@domain.com").click()\n    page.get_by_placeholder("user@domain.com").fill("username")\n    page.get_by_role("button", name="Next").click()\n    page.locator("#i0118").fill("password")\n    page.get_by_role("button", name="Sign in").click()\n    page.get_by_role("button", name="Approve a request on my Microsoft Authenticator app").click()\n    page.goto("https://login.microsoftonline.com/common/SAS/ProcessAuth")\n\n    page.get_by_role("button", name="Browse ").click()\n    page.get_by_role("link", name="All applications").click()\n    page.get_by_role("link", name="App ").click()\n    page.get_by_role("button", name="Click here").click()\n    page.get_by_role("link", name="Categories").click()\n    page.get_by_role("link", name="ava").click()\n    page.get_by_role("menuitem", name="Profile").click()\n    page.get_by_text("what").click()\n    page.get_by_text("what", exact=True).click()\n    page.locator("div").filter(has_text=re.compile(r"^tech$")).nth(2).click()\n    page.get_by_text("what", exact=True).click()\n    page.get_by_test_id("update-").click()\n    page.get_by_role("button", name="close").click()\n    page.get_by_role("link", name="logo").click()\n    page.locator(".text-primary").click()\n    page.get_by_role("link", name="about").click()\n    page.get_by_text("Go to").click()\n    page.get_by_role("link", name="App store").click()\n    page.get_by_role("link", name="My ").click()\n    page.get_by_role("link", name="All ").click()\n    page.get_by_role("link", name="cat").click()\n    page.get_by_role("link", name="col").click()\n    page.get_by_test_id("what").click()\n    page.locator(".img-screen").first.click()\n    page.get_by_role("dialog").click()\n    page.get_by_role("dialog").click()\n    page.get_by_placeholder("Search for ").click()\n    page.get_by_placeholder("Search for ").fill("what")\n    page.get_by_placeholder("Search for ").press("Enter")\n    page.locator("#btn-item-3").click()\n    page.locator("#btn-item-5").click()\n    page.get_by_role("link", name="My ").click()\n    page.get_by_role("link", name="App ").click()\n    page.get_by_role("link", name="App ").click(button="right")\n    page.locator("div").filter(has_text=re.compile(r"^what$")).get_by_role("link", name="View all").click()\n    page.locator("div:nth-child(2) > div > .img-screen").click()\n    page.get_by_role("link", name="name").click()\n\n\n    # ---------------------\n    context.close()\n    browser.close()\n\n\nwith sync_playwright() as playwright:\n    run(playwright)\n\n\n\nimport os\n# Get session storage and store as env variable\nsession_storage = page.evaluate("() => JSON.stringify(sessionStorage)")\nos.environ["SESSION_STORAGE"] = session_storage\n\n# Set session storage in a new context\nsession_storage = os.environ["SESSION_STORAGE"]\ncontext.add_init_script("""(storage => {\n  if (window.location.hostname === \'example.com\') {\n    const entries = JSON.parse(storage)\n    for (const [key, value] of Object.entries(entries)) {\n      window.sessionStorage.setItem(key, value)\n    }\n  }\n})(\'""" + session_storage + "\')")\n\n\nfrom playwright.sync_api import sync_playwright\n\n\npath_to_extension = "./my-extension"\nuser_data_dir = "/tmp/test-user-data-dir"\n\n\ndef run(playwright):\n    context = playwright.chromium.launch_persistent_context(\n        user_data_dir,\n        headless=False,\n        args=[\n            f"--disable-extensions-except={path_to_extension}",\n            f"--load-extension={path_to_extension}",\n        ],\n    )\n    if len(context.background_pages) == 0:\n        background_page = context.wait_for_event(\'backgroundpage\')\n    else:\n        background_page = context.background_pages[0]\n\n    # Test the background page as you would any other page.\n    context.close()\n\n\nwith sync_playwright() as playwright:\n    run(playwright)\n\n\nfrom playwright.sync_api import Playwright, sync_playwright\n\ndef print_request_sent(request):\n  print("Request sent: " + request.url)\n\ndef print_request_finished(request):\n  print("Request finished: " + request.url)\n\ndef on_web_socket(ws):\n    print(f"WebSocket opened: {ws.url}")\n    ws.on("framesent", lambda payload: print(payload))\n    ws.on("framereceived", lambda payload: print(payload))\n    ws.on("close", lambda payload: print("WebSocket closed"))\n\n\n\n\nwith sync_playwright() as p:\n    browser = p.chromium.launch(headless=False)\n    context = browser.new_context(storage_state="state.json",ignore_https_errors=True,viewport={"width": 1600, "height": 1200})\n    # storage = context.storage_state(path="state.json")\n    page = context.new_page()\n    #\n    # page.on("request", print_request_sent)\n    # page.on("requestfinished", print_request_finished)\n    # page.on("response", lambda response: print("<<", response.status, response.url))\n    # page.on("websocket", on_web_socket)\n\n    with page.expect_response("**/api/fetch_data") as response_info:\n\n     page.goto(\'what\')\n     page.wait_for_load_state(\'networkidle\')\n     page.wait_for_timeout(5000)\n     response = response_info.value\n\n\n\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'playwright codegen demo.playwright.dev/todomvc\n\nusing var playwright = await Playwright.CreateAsync();\n        await using var browser = await playwright.Chromium.LaunchAsync(new BrowserTypeLaunchOptions\n        {\n            Headless = false,\n        });\n        var context = await browser.NewContextAsync();\n\n        var page = await context.NewPageAsync();\n\n        await page.GotoAsync("about:blank");\n\n        await page.GotoAsync("chrome-error://chromewebdata/");\n\n        await page.Locator("div").Filter(new() { HasText = "Your connection is not private Attackers might be trying to steal your informati" }).First.ClickAsync();\n\nawait page.GotoAsync("https://google.com");\nawait page.GetByPlaceholder("user@domain.com").ClickAsync();\nawait page.GetByRole(AriaRole.Button, new() { Name = "Next" }).ClickAsync();\nawait page.GetByRole(AriaRole.Link, new() { Name = "Proceedom (unsafe)" }).ClickAsync();\n\nawait page.GetByPlaceholder("user@domain.com").FillAsync("username");\nawait page.Locator("#i0118").FillAsync("password");\n\nawait page.GetByRole(AriaRole.Button, new() { Name = "Browse what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "All what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "App what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Button, new() { Name = "Click here" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "what what what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Menuitem, new() { Name = "what" }).ClickAsync();\n\n        await page.GetByText("what what").ClickAsync();\n\n        await page.GetByText("what what", new() { Exact = true }).ClickAsync();\n\n        await page.Locator("div").Filter(new() { HasTextRegex = new Regex("^what$") }).Nth(2).ClickAsync();\n\n        await page.GetByText("what", new() { Exact = true }).ClickAsync();\n\n        await page.GetByTestId("what").ClickAsync();\n\n        await page.GetByRole(AriaRole.Button, new() { Name = "close" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "what" }).ClickAsync();\n\n        await page.Locator(".text-primary").ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "what" }).ClickAsync();\n\n        await page.GetByText("Go to portal").ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "App what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "My what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "All what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "what" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "what" }).ClickAsync();\n\n        await page.GetByTestId("what").ClickAsync();\n\n        await page.Locator(".img-screen").First.ClickAsync();\n\n        await page.GetByRole(AriaRole.Dialog).ClickAsync();\n\n        await page.GetByRole(AriaRole.Dialog).ClickAsync();\n\n        await page.GetByPlaceholder("Search for apps").ClickAsync();\n\n        await page.GetByPlaceholder("Search for apps").FillAsync("esg");\n\n        await page.GetByPlaceholder("Search for apps").PressAsync("Enter");\n\n        await page.Locator("#btn-item-3").ClickAsync();\n\n        await page.Locator("#btn-item-5").ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "My " }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "App store" }).ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "App store" }).ClickAsync(new LocatorClickOptions\n        {\n            Button = MouseButton.Right,\n        });\n\n        await page.Locator("div").Filter(new() { HasTextRegex = new Regex("^New all$") }).GetByRole(AriaRole.Link, new() { Name = "View all" }).ClickAsync();\n\n        await page.Locator("div:nth-child(2) > div > .img-screen").ClickAsync();\n\n        await page.GetByRole(AriaRole.Link, new() { Name = "All " }).ClickAsync();\n\n\n\n\n\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"# pylint: disable-all\nfrom playwright.sync_api import sync_playwright\nimport time\n\ndef launch_browser(url, path):\n    with sync_playwright() as playwright:\n        # browser = playwright.chromium.launch(headless=False,slow_mo=1000)\n        browser = playwright.chromium.launch()\n        context = browser.new_context(ignore_https_errors=True)\n        page = context.new_page()\n        page.goto(url,wait_until='commit',timeout=100000)\n        page.wait_for_timeout(30000)\n        page.screenshot(path=path, full_page=True)\n        browser.close()\n\nlaunch_browser('https://edition.cnn.com/', './static/scr/cnn.png')\nlaunch_browser('https://www.bbc.com/', './static/scr/bbc.png')\nlaunch_browser('https://www.cnbc.com/', './static/scr/cnbc.png')\n\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'\n\nimport requests\nimport json\nimport base64\nfrom playwright.sync_api import Playwright, sync_playwright\nimport urllib3\n# import httplib2\n\nwebhook_url = \'hhh\'\n\nwith sync_playwright() as p:\n    browser = p.chromium.launch(headless=False)\n    context = browser.new_context(storage_state="state.json",ignore_https_errors=True,viewport={"width": 1600, "height": 1200})\n    page = context.new_page()\n    data = []\n    def handle_response(response):\n        if "/api/" in response.url:\n            data.append({"url": response.url, "status": response.status})\n    page.on("response", handle_response)\n    page.goto(\'gg\')\n    page.wait_for_load_state(\'networkidle\')\n    page.screenshot(path=\'temp/home.jpeg\',type=\'jpeg\',quality=5,full_page=True)\n    print(data)\n\n# Load the screenshot file and encode it as base64\nwith open("temp/home.jpeg", "rb") as f:\n    image = base64.b64encode(f.read())\n\n# Create the adaptive card JSON payload\ncard = {\n  "type": "message",\n  "attachments": [\n    {\n      "contentType": "application/vnd.microsoft.card.adaptive",\n      "content": {\n        "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",\n        "type": "AdaptiveCard",\n        "version": "1.2",\n        "body": [\n          {\n            "type": "TextBlock",\n            "text": f"{data}",\n            "size": "Large",\n            "weight": "Bolder"\n          },\n          {\n            "type": "ColumnSet",\n            "columns": [\n              {\n                "type": "Column",\n                "items": [\n                  {\n                    "type": "TextBlock",\n                    "text": "API",\n                    "weight": "Bolder"\n                  }\n                ],\n                "width": "auto"\n              },\n              {\n                "type": "Column",\n                "items": [\n                  {\n                    "type": "TextBlock",\n                    "text": "Status",\n                    "weight": "Bolder"\n                  }\n                ],\n                "width": "auto"\n              }\n            ]\n          },\n          {\n            "$data": f"{data}",\n            "type": "ColumnSet",\n            "columns": [\n              {\n                "type": "Column",\n                "items": [\n                  {\n                    "type": "TextBlock",\n                    "text": f"{data}"\n                  }\n                ],\n                "width": "auto"\n              },\n              {\n                "type": "Column",\n                "items": [\n                  {\n                    "type": "TextBlock",\n                    "text": f"{data}"\n                  }\n                ],\n                "width": "auto"\n              }\n            ]\n          },\n          {\n            "type": "Image",\n            "url": f"data:image/jpeg;base64,{image.decode()}",\n            "size": "Large",\n            "horizontalAlignment": "Center"\n          }\n        ]\n      }\n    }\n  ]\n}\n\n# response = requests.post(url=webhook_url, json=card)\n\n# if response.status_code == 200:\n#   print("Card sent successfully")\n# else:\n#   print("Error sending card: ", response.status_code)\n\nhttp = urllib3.PoolManager(cert_reqs=\'CERT_NONE\')\nresponse = http.request(\'POST\', webhook_url, json=card)\nprint(response.status, response.data)\n\n\n# import httplib2\n# # Create an http object that disables SSL verification\n# http = httplib2.Http(disable_ssl_certificate_validation=True)\n# # Make a post request\n# response, content = http.request(\'https://example.com/api\', \'POST\', body=\'bar=baz\')\n# # Print the status code and content\n# print(response.status, content)\n\n\nfrom playwright.sync_api import Playwright, sync_playwright\n\ndef print_request_sent(request):\n  print("Request sent: " + request.url)\n\ndef print_request_finished(request):\n  print("Request finished: " + request.url)\n\ndef on_web_socket(ws):\n    print(f"WebSocket opened: {ws.url}")\n    ws.on("framesent", lambda payload: print(payload))\n    ws.on("framereceived", lambda payload: print(payload))\n    ws.on("close", lambda payload: print("WebSocket closed"))\n\n\n\n\nwith sync_playwright() as p:\n\n    browser = p.chromium.launch(headless=False)\n    context = browser.new_context(storage_state="state.json",ignore_https_errors=True,viewport={"width": 1600, "height": 1200})\n    # storage = context.storage_state(path="state.json")\n    page = context.new_page()\n    #\n    # page.on("request", print_request_sent)\n    # page.on("requestfinished", print_request_finished)\n    # page.on("response", lambda response: print("<<", response.status, response.url))\n    # page.on("websocket", on_web_socket)\n    data = []\n    # with page.expect_response("**/api/fetch_data") as response_info:\n    def handle_request(response):\n     # Check if the request url contains the word api\n     if "/api/" in response.url:\n      # Append the request url and status code to the data list\n      data.append([response.url, response.status])\n\n\n    page.on("response", handle_request)\n    page.goto(\'gg\')\n    page.wait_for_load_state(\'networkidle\')\n    print(data)\n\n    page.wait_for_timeout(5000)\n    #  response = response_info.value\n\nimport requests\nimport json\nimport base64\nfrom playwright.sync_api import Playwright, sync_playwright\nimport urllib3\n# import httplib2\n\nwebhook_url = \'gg\'\n\nbase_url = \'\'\n\nwith sync_playwright() as p:\n    browser = p.chromium.launch(headless=False)\n    context = browser.new_context(storage_state="state.json",ignore_https_errors=True,viewport={"width": 1600, "height": 1200})\n    page = context.new_page()\n    data = []\n    data1 = \' \'\n    def handle_response(response):\n        global data\n        global data1\n        if "/api/" in response.url:\n            modified_url = response.url.replace(base_url, \'\')\n            data.append({"title": modified_url, "value": response.status})\n            # data.append(f"{response.url} {response.status}")\n            data1 += f"\\n\\n\\n\\n{response.url} {response.status}\\n\\n\\n"\n    page.on("response", handle_response)\n    page.goto(\'hh\')\n    page.wait_for_load_state(\'networkidle\')\n    page.screenshot(path=\'temp/home.jpeg\',type=\'jpeg\',quality=5,full_page=True)\n    print(data)\n\n# Load the screenshot file and encode it as base64\nwith open("temp/home.jpeg", "rb") as f:\n    image = base64.b64encode(f.read())\n\n# Create the adaptive card JSON payload\ncard = {\n  "type": "message",\n  "attachments": [\n    {\n      "contentType": "application/vnd.microsoft.card.adaptive",\n      "content": {\n        "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",\n        "type": "AdaptiveCard",\n        "version": "1.5",\n        "body": [\n\n\n\n\n                 {\n            "type": "TextBlock",\n            "text": data1,\n            "spacing": "Padding",\n            "horizontalAlignment": "Left",\n            "maxLines": 1000,\n            "wrap": True,\n            "fontType": "Monospace",\n            "size": "Small",\n            "weight": "Bolder",\n            "color": "Dark",\n            "isSubtle": False,\n            "separator": True\n        },\n\n                {\n                    "type": "FactSet",\n                    "facts": data,\n            "spacing": "Medium",\n            "separator": True,\n            "height": "stretch"\n                }\n\n    ]}}\n\n\n        ]\n      }\n\n\n\n# response = requests.post(url=webhook_url, json=card)\n\n# if response.status_code == 200:\n#   print("Card sent successfully")\n# else:\n#   print("Error sending card: ", response.status_code)\n\nhttp = urllib3.PoolManager(cert_reqs=\'CERT_NONE\')\nresponse = http.request(\'POST\', webhook_url, json=card)\nprint(response.status, response.data)\n\n\n# import httplib2\n# # Create an http object that disables SSL verification\n# http = httplib2.Http(disable_ssl_certificate_validation=True)\n# # Make a post request\n# response, content = http.request(\'https://example.com/api\', \'POST\', body=\'bar=baz\')\n# # Print the status code and content\n# print(response.status, content)\n\n')))}y.isMDXComponent=!0}}]);