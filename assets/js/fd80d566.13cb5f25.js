"use strict";(self.webpackChunkfluentblogs=self.webpackChunkfluentblogs||[]).push([[432],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>g});var r=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},l=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},y=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),d=c(t),y=i,g=d["".concat(s,".").concat(y)]||d[y]||u[y]||a;return t?r.createElement(g,o(o({ref:n},l),{},{components:t})):r.createElement(g,o({ref:n},l))}));function g(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,o=new Array(a);o[0]=y;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p[d]="string"==typeof e?e:i,o[1]=p;for(var c=2;c<a;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}y.displayName="MDXCreateElement"},97593:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>g,frontMatter:()=>p,metadata:()=>c,toc:()=>d});var r=t(87462),i=t(63366),a=(t(67294),t(3905)),o=["components"],p={keywords:["Notes"]},s=void 0,c={unversionedId:"Developer Random Notes",id:"Developer Random Notes",title:"Developer Random Notes",description:"Sql script to Add Managed Identity of Application to Database",source:"@site/docs/Developer Random Notes.md",sourceDirName:".",slug:"/Developer Random Notes",permalink:"/docs/Developer Random Notes",draft:!1,tags:[],version:"current",frontMatter:{keywords:["Notes"]},sidebar:"myAutogeneratedSidebar",previous:{title:"Azure Powershell",permalink:"/docs/Azure Powershell"},next:{title:"Freelancing",permalink:"/docs/Freelancing"}},l={},d=[],u={toc:d},y="wrapper";function g(e){var n=e.components,t=(0,i.Z)(e,o);return(0,a.kt)(y,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Sql script to Add Managed Identity of Application to Database"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"DECLARE @dbName VARCHAR(100) = (SELECT DB_NAME())\nDECLARE @environment CHAR(4) =  CASE\n                                    WHEN (@dbName) LIKE '%dev%' THEN 'dev'\n                                    END;\n\nDECLARE @AppName VARCHAR(100) = 'func-' + @environment + '-latex-01';\nIF EXISTS (SELECT * FROM sys.sysusers WHERE [name] = @AppName)\nBEGIN\n    EXECUTE ('DROP USER ['+ @AppName + ']')\nEND\nEXECUTE ('CREATE USER ['+ @AppName + '] FROM EXTERNAL PROVIDER;')\nEXECUTE ('ALTER ROLE db_datareader ADD MEMBER ['+ @AppName + '];')\nEXECUTE ('ALTER ROLE db_datawriter ADD MEMBER ['+ @AppName + '];')\nEXECUTE ('ALTER ROLE db_owner ADD MEMBER ['+ @AppName + '];')\nGO\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},' public static string GetHtmlTableFromDataTable(DataTable dt)\n        {\n            var sb = new StringBuilder();\n            sb.Append("<div style=\\"overflow-x:auto;\\">");\n            //Table start.\n            sb.Append(@"<table class=\'GeneratedTable\'>");\n            //Adding HeaderRow.\n            sb.Append("<tr>");\n            foreach (DataColumn column in dt.Columns)\n            {\n                sb.Append("<th>" + column.ColumnName + "</th>");\n            }\n            sb.Append("</tr>");\n            //Adding DataRow.\n            foreach (DataRow row in dt.Rows)\n            {\n                sb.Append("<tr>");\n                foreach (DataColumn column in dt.Columns)\n                {\n                    sb.Append("<td>" + row[column.ColumnName] + "</td>");\n                }\n                sb.Append("</tr>");\n            }\n            //Table end.\n            sb.Append("</table>");\n            sb.Append("</div>");\n\n            return sb.ToString();\n        }\n\n        ///////////////////////////////////\n\n        [AttributeUsage(AttributeTargets.All)]\npublic class ScopedRegistrationAttribute : Attribute\n{\n}\n\n[AttributeUsage(AttributeTargets.All)]\npublic class ScopedPriorityRegistrationAttribute : Attribute\n{\n}\n\n[AttributeUsage(AttributeTargets.All)]\npublic class SingletonRegistrationAttribute : Attribute\n{\n}\n\n[AttributeUsage(AttributeTargets.All)]\npublic class TransientRegistrationAttribute : Attribute\n{\n}\n\n[AttributeUsage(AttributeTargets.All)]\npublic class TransientPriorityRegistrationAttribute : Attribute\n{\n}\n\npublic static class RegisterServicesUsingAttributeExtensions\n{\n    public static void RegisterServicesUsingAttribute(this IServiceCollection services)\n    {\n        // Define types that need matching\n        var scopedRegistration = typeof(ScopedRegistrationAttribute);\n        var scopedPriorityRegistration = typeof(ScopedPriorityRegistrationAttribute);\n        var singletonRegistration = typeof(SingletonRegistrationAttribute);\n        var transientRegistration = typeof(TransientRegistrationAttribute);\n        var transientPriorityRegistration = typeof(TransientPriorityRegistrationAttribute);\n        var types = AppDomain.CurrentDomain.GetAssemblies()\n            .SelectMany(s => s.GetTypes())\n            .Where(p => (p.IsDefined(scopedRegistration, true) || p.IsDefined(transientRegistration, true) ||\n                         p.IsDefined(singletonRegistration, true) || p.IsDefined(scopedPriorityRegistration, true) ||\n                         p.IsDefined(transientPriorityRegistration, true)) && !p.IsInterface)\n            .Select(s => new { Service = s.GetInterface($"I{s.Name}"), Implementation = s })\n            .Where(x => x.Service != null);\n        var typesList = types.ToList();\n        var scopedPriorityTypes = typesList\n            .Where(type => type.Implementation.IsDefined(scopedPriorityRegistration, false))\n            .ToList();\n        foreach (var type in scopedPriorityTypes)\n        {\n            services.AddScoped(type.Service ?? throw new InvalidOperationException(), type.Implementation);\n        }\n\n        var transientPriorityTypes = typesList\n            .Where(type => type.Implementation.IsDefined(transientPriorityRegistration, false))\n            .ToList();\n        foreach (var type in transientPriorityTypes)\n        {\n            services.AddTransient(type.Service ?? throw new InvalidOperationException(), type.Implementation);\n        }\n\n        foreach (var type in typesList)\n        {\n            if (type.Implementation.IsDefined(scopedRegistration, false))\n            {\n                services.AddScoped(type.Service ?? throw new InvalidOperationException(), type.Implementation);\n            }\n\n            if (type.Implementation.IsDefined(transientRegistration, false))\n            {\n                services.AddTransient(type.Service ?? throw new InvalidOperationException(), type.Implementation);\n            }\n\n            if (type.Implementation.IsDefined(singletonRegistration, false))\n            {\n                services.AddSingleton(type.Service ?? throw new InvalidOperationException(), type.Implementation);\n            }\n        }\n    }\n}\n\n///////////////\n\npublic class BaseQueryDto\n{\n    public int? PageSize { get; set; }\n    public bool First { get; set; }\n\n    public string? Before { get; set; }\n\n    public string? After { get; set; }\n\n    public bool Last { get; set; }\n    public int? Page { get; set; }\n\n    public string? Search { get; set; }\n}\n\n [HttpGet]\n    [Route("first")]\n    public async Task<ActionResult<KeysetPaginationResult<IdNameDto>>> GetFunds([FromQuery] BaseQueryDto baseQueryDto)\n    {\n        var list = await _cqQueryService.GetFundsAsync(baseQueryDto);\n\n        return Ok(list);\n    }\n\n    public async Task<KeysetPaginationResult<IdNameDto>> GetFundsAsync(BaseQueryDto baseQueryDto)\n    {\n        return await _cqRepositoryManager.cqQuery.GetFundsAsync(baseQueryDto);\n    }\n\n  using LinqKit;\n\n\npublic class cqQueryRepository : RepositoryBase<cqContext, pgp>, IcqQueryRepository\n{\n    private readonly IPaginationService _paginationService;\n    private readonly cqContext _cqContext;\n    private static readonly int CurrentDateAsInt = int.Parse(DateTime.Now.ToString("yyyyMMdd"));\n\n    public cqQueryRepository(cqContext cqContext, IPaginationService paginationService) : base(cqContext)\n    {\n        _cqContext = cqContext;\n        _paginationService = paginationService;\n    }\n\n    public async Task<KeysetPaginationResult<IdNameDto>> GetigosAsync(BaseQueryDto baseQueryDto)\n    {\n        var query = from o in _cqContext.qgos\n                    join oi in _cqContext.qgoidps on o.qgoKey equals oi.qgoKey into g1\n                    from ooi in g1.AsQueryable()\n                        .Where(x => x.qgoidpTypeCode == qgoidpType.idp.ToString()).DefaultIfEmpty()\n                    select new { Id = ooi.qgoidpValue ?? o.qgoId, Name = o.qgoName };\n        if (!string.IsNullOrWhiteSpace(baseQueryDto.Search))\n        {\n            query = query.Where(e => (e.Id + e.Name).Trim().ToLower().Contains(baseQueryDto.Search.Trim().ToLower()));\n        }\n\n        return await _paginationService.KeysetPaginateAsync(query.AsNoTracking(), b => b.Ascending(x => x.Id),\n            async id => await query.AsNoTracking().FirstAsync(x => x.Id == id),\n            q => q.Select(x => new IdNameDto { Id = x.Id, Name = x.Name }));\n    }\n\n    public async Task<KeysetPaginationResult<IdNameDto>> GetFundsAsync(BaseQueryDto baseQueryDto)\n    {\n        var predicate = PredicateBuilder.New<pgpidp>();\n        predicate = predicate.And(p => p.ValidFromDateKey <= CurrentDateAsInt);\n        predicate = predicate.And(p => p.ValidToDateKey >= CurrentDateAsInt);\n        predicate = predicate.And(p => p.pgpidpType == pgpidpTypeEnum.idp_ID.ToString());\n        var query = from p in _cqContext.pgps.AsExpandable()\n                    join pf in _cqContext.pgpFunds.AsExpandable() on p.pgpKey equals pf.pgpKey into g1\n                    from ppf in g1\n                    join pi in _cqContext.pgpidps.AsExpandable() on ppf.pgpKey equals pi.pgpKey into\n                        g2\n                    from ppfpi in g2.AsQueryable().Where(predicate).DefaultIfEmpty()\n                    where p.InceptionDateKey <= CurrentDateAsInt && p.TerminationDateKey >= CurrentDateAsInt &&\n                          p.pgpName != string.Empty\n                    select new { Id = ppfpi.pgpidpValue ?? p.pgpID, Name = p.pgpName };\n        if (!string.IsNullOrWhiteSpace(baseQueryDto.Search))\n        {\n            query = query.Where(e => (e.Id + e.Name).Trim().ToLower().Contains(baseQueryDto.Search.Trim().ToLower()));\n        }\n\n        return await _paginationService.KeysetPaginateAsync(query.AsNoTracking(), b => b.Ascending(x => x.Id),\n            async id => await query.AsNoTracking().FirstAsync(x => x.Id == id),\n            q => q.Select(x => new IdNameDto { Id = x.Id, Name = x.Name }));\n    }\n\n    public async Task<KeysetPaginationResult<IdNameDto>> GetbjpAsync(BaseQueryDto baseQueryDto)\n    {\n        var predicate = PredicateBuilder.New<pgpidp>();\n        predicate = predicate.And(p => p.ValidFromDateKey <= CurrentDateAsInt);\n        predicate = predicate.And(p => p.ValidToDateKey >= CurrentDateAsInt);\n        predicate = predicate.And(p => p.pgpidpType == pgpidpTypeEnum.idp_ID.ToString());\n        var query = from p in _cqContext.pgps\n                    join b in _cqContext.bjp on p.pgpKey equals b.pgpKey into g1\n                    from pb in g1\n                    join pi in _cqContext.pgpidps on pb.pgpKey equals pi.pgpKey into g2\n                    from pbpi in g2.AsQueryable().Where(predicate).DefaultIfEmpty()\n                    where p.InceptionDateKey <= CurrentDateAsInt && p.TerminationDateKey >= CurrentDateAsInt &&\n                          p.pgpName != string.Empty\n                    select new { Id = pbpi.pgpidpValue ?? p.pgpID, Name = p.pgpName };\n        if (!string.IsNullOrWhiteSpace(baseQueryDto.Search))\n        {\n            query = query.Where(e => (e.Id + e.Name).Trim().ToLower().Contains(baseQueryDto.Search.Trim().ToLower()));\n        }\n\n        return await _paginationService.KeysetPaginateAsync(query.AsNoTracking(), b => b.Ascending(x => x.Id),\n            async id => await query.AsNoTracking().FirstAsync(x => x.Id == id),\n            q => q.Select(x => new IdNameDto { Id = x.Id, Name = x.Name }));\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM sys.database_principals\n")))}g.isMDXComponent=!0}}]);